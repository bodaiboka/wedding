<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Nino and Ricsi">
    <meta property="og:description" content="We are delighted to inform you that we are pledging eternal fidelity to each other, and therefore we invite you to our wedding, which will be held on July 28 2023.">
    <meta property="og:image" content="https://www.nino-ricsi.wedding/public/models/thumbnail.png">
    <meta property="og:url" content="https://www.nino-ricsi.wedding">
    <title>Nini + Ricsi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="canvas-container">
        <canvas id="wedding-canvas"></canvas>
    </div>

    <div class="welcome" >
        <div class="welcome-icon">É</div>

        <p data-translate-key="intro_1" class="welcome-text" id="guest-names">Kedves szerettünk!</p>
        <p data-translate-key="intro_1_1" class="welcome-text">Örömmel értesítünk, hogy</p>

        <div class="welcome-title"><h1>ichárnin</h1></div>

        <p data-translate-key="intro_2" class="welcome-text">örök hűséget fogadunk egymásnak, ezért meghívunk titeket esküvőnkre, melynek időpontja</p>

        <div class="date">
            <div data-translate-key="july" class="month"><p>július</p></div>
            <div class="day"><p>28</p><p data-translate-key="friday">péntek</p></div>
            <div class="year"><p>2023</p></div>
        </div>

        <div class="info">
            <div class="details shake-rep">
                <p data-translate-key="details">részletek</p>
                <i class="bi bi-chevron-double-down"></i>
                <!-- <i class="bi bi-chevron-double-up"></i> -->
                
            </div>
    
            <div class="info-bar">
                <div class="church-btn">&#x47;</div>
                <div class="civil-btn">&#x50;</div>
                <div class="dinner-btn">&#xFF;</div>
                <div class="cake-btn">&#xB6;</div>
                <div class="info-btn">&#xB4;</div>
            </div>
        </div>
    </div>

    <div class="info-details-container start">
        <div class="info-details-section">
            <p class="info-details-time">15:00</p>
            <h2 data-translate-key="church_title">Templomi esküvő</h2>
            <a href="https://goo.gl/maps/Sey7AfuV1kieLpu86">
            <p class="google-maps">Mindszenti templom</p>
            <p class="google-maps">Miskolc, Mindszent tér 2-4, 3530 <i class="bi bi-geo-alt-fill"></i></p></a>
            <p class="info-details-note" data-translate-key="church_description">Nagy szeretettel várjuk barátainkat, ismerőseinket és szeretteinket az esküvői szertartásra. Kérünk benneteket, hogy a szertartás kezdetét megelőzően legalább 10 perccel már foglaljatok helyet a templomban.</p>
        </div>
        <div class="info-details-section">
            <p class="info-details-time">17:00</p>
            <h2 data-translate-key="civil_title">Polgári esküvő</h2>
            <a href="https://goo.gl/maps/j8kCfwNF5rxgNoTbA">
            <p class="google-maps">Molnár Csárda Rendezvénysátor</p>
            <p class="google-maps">Miskolc, Vadas Jenő u. 1, 3517 <i class="bi bi-geo-alt-fill"></i></p></a>
            <p class="info-details-note" data-translate-key="civil_description">A szertartás előtt frissítő falatokkal és italokkal várunk benneteket a helyszínen.</p>
        </div>
        <div class="info-details-section">
            <p class="info-details-time">19:00</p>
            <h2 data-translate-key="dinner_title">Vacsora</h2>
            <p data-translate-key="dinner_description"></p>
        </div>
        <div class="info-details-section">
            <p class="info-details-time">23:00</p>
            <h2 data-translate-key="cake_title">Torta</h2>
            <p data-translate-key="cake_description">Szívünk édességét és szerelmünk ízét megosztjuk veletek, amint az esküvői tortánkba beleharapunk. Várjuk, hogy együtt ünnepeljünk ebben a különleges pillanatban.</p>
        </div>
        <div class="info-details-section">
            <h2 data-translate-key="info_title">Információ</h2>
            <p class="info-details-respond-p" data-translate-key="info_description"></p>
            <form>
                <div class="info-table">
                    <div class="info-table-titles">
                        <div data-translate-key="info_name" class="name">Name</div>
                        <div data-translate-key="info_attending" class="attend">Attending</div>
                        <div data-translate-key="info_vegan" class="vegetarian">Vegetarian</div>
                        <div data-translate-key="info_age3" class="age">Age under 3</div>
                    </div>
                    <div class="info-table-data">

                    </div>
                </div>

                <form  action="#">
                    <div class="info-form">
                        <input type="text" id="myInput" placeholder="Name">
                        <button type="button" data-translate-key="info_add_guest" class="info-add-guest-button"></button>
                    </div>                    
                </form>
                <button data-translate-key="info_submit" class="info-send-button" type="button">Send answer</button>
            </form>
        </div>
    </div>

    <div id="popup" class="popup">
        <span id="popup-message"></span>
      </div>
      
    
    <script type="module" src="graphics.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function() {

            function showToast(message, duration, pre, post) {
                var popup = $('#popup');
                var popupMessage = $('#popup-message');
                
                if (!popup.is(":visible")) {
                    if (pre != null) pre()
                    popupMessage.text(message);
                    popup.show(200);
                    
                    setTimeout(function() {
                        popup.hide(200)
                        if (post != null) post()
                    }, duration);
                }  
            }

            let oneTimeHelp = false;
            let lang  = 'hu';
            let strings = {

                "hu": {
                    intro_1: "Kedves ",
                    intro_1_1: "Örömmel értesítünk, hogy",
                    intro_2: "örök hűséget fogadunk egymásnak, ezért meghívunk titeket esküvőnkre, melynek időpontja",
                    july: "július",
                    friday: "péntek",
                    details: "Részletek",
                    church_title: "Templomi Esküvő",
                    church_description: "Érkezés 14:30-tól. Kérünk benneteket, hogy a szertartás kezdetét megelőzően legalább 10 perccel már foglaljatok helyet a templomban. Parkolás a templom saját udvarán lehetséges.",
                    civil_title: "Polgári Esküvő",
                    civil_description: "A ceremónia előtt frissítő falatokkal és italokkal várunk benneteket a helyszínen.",
                    dinner_title: "Vacsora",
                    dinner_description: "Az esküvői lakoma nem csak az ételekről szól, hanem az öröm, a nevetés és a szeretet megosztásáról is. Ezen az estén egy hangulatos sátras vacsora mellett kívánunk veletek koccintani a jövőre.",
                    cake_title: "Torta",
                    cake_description: "Csatlakozzatok hozzánk, amint egy édes szelettel megpecsételjük az életünk új fejezetét. A torta íze olyan, mint a mi szerelmünk: édes és ellenállhatatlan. :)<br>A tortázást a menyecsketánccal folytatjuk.",
                    info_title: "Visszajelzés",
                    info_description: "Kérünk benneteket, hogy jelezzetek vissza az alábbi form kitöltésével legkésőbb július 23-ig a vacsorával kapcsolatban. A '3 év alatti' oszlop a legfeljebb 3 éves gyermekekre vonatkozik.",
                    info_name: "Név",
                    info_attending: "Részt vesz",
                    info_vegan: "Vegán",
                    info_age3: "3 év alatti",
                    info_note: "Megjegyzés",
                    input_placeholder: "Kísérő neve",
                    info_add_guest: "Kísérő hozzáadása",
                    info_submit: "Válasz elküldése",
                    popup_companion: "Először add meg a kísérő nevét a mezőben.",
                    popup_respond_success: "Köszönjük, megkaptuk a válaszod.",
                    tipp_google_maps: "Kattints a címre, hogy ha szeretnéd megtekinteni google maps-en is.",
                    tipp_respond: "Köszönjük, hogy már válaszoltál. Július 23-ig még módosíthatod válaszodat, csak küldd el újra.",
                    tipp_gift: "Ha ajándékkal készülsz, nagyra értékelnénk a pénzbeli hozzájárulást, ami segít elindulnunk a házas élet útján."
                },

                "en": {
                    intro_1: "Dear ",
                    intro_1_1: "We are delighted to inform you that",
                    intro_2: "we are pledging eternal fidelity to each other, and therefore we invite you to our wedding, which will be held on",
                    july: "July",
                    friday: "Friday",
                    details: "Details",
                    church_title: "Church Ceremony",
                    church_description: "We kindly ask you to take your seats in the church 10 minutes before the ceremony begins. Parking is possible in the church's own courtyard.",
                    civil_title: "Civil Ceremony",
                    civil_description: "We will be waiting for you with refreshing bites and drinks at the venue before the ceremony.",
                    dinner_title: "Dinner",
                    dinner_description: "The wedding feast will not just be about the food, but also about sharing joy, laughter, and love. On this evening, we will wish to toast to the future with you beside a cozy tented dinner..",
                    cake_title: "Cake",
                    cake_description: "Join us as we will seal the new chapter of our lives with a sweet slice. The taste of the cake will be like our love: sweet and irresistible. :)",
                    info_title: "Please respond",
                    info_description: "We kindly ask you to respond by filling out the form related to the dinner below no later than July 23. The column labeled 'up to 3y old' refers to children who are 3 years old or younger.",
                    info_name: "Name",
                    info_attending: "Will attend",
                    info_vegan: "Vegan",
                    info_age3: "Up to 3y old",
                    info_note: "Note",
                    input_placeholder: "Name",
                    info_add_guest: "Add a companion",
                    info_submit: "Submit a reply",
                    popup_companion: "Please enter your companion's name in the relevant field provided.",
                    popup_respond_success: "Thank you, we have received your response.",
                    tipp_google_maps: "Please click on the address, if you would like to view it on Google Maps as well.",
                    tipp_respond: "Thank you for your response. You can make modifications to your answer until July 23, simply send it again.",
                    tipp_gift: "If you wish to give a gift, we would be honored to receive a monetary contribution to help us start our journey as a married couple."
                },

                "ge": {
                    intro_1: "ძვირფასო ",
                    intro_1_1: "მოხარულები ვართ გაცნობოთ, რომ",
                    intro_2: "ჩვენ ვპირდებით ერთმანეთს მარადიულ ერთგულებას და ამიტომ გეპატიჟებით ჩვენს ქორწილში, რომელიც გაიმართება:",
                    july: "ივლისს",
                    friday: "პარასკევს",
                    details: "დეტალები",
                    church_title: "ჯვრისწერა",
                    church_description: "გთხოვთ, დაიკავოთ ადგილები ეკლესიაში ცერემონიის დაწყებამდე 10 წუთით ადრე. პარკინგი შესაძლებელია ეკლესიის ეზოში.",
                    civil_title: "ხელმოწერა",
                    civil_description: " ხელმოწერის ცერემონიის დაწყებამდე გაგიმასპინძლდებით გამაგრილებელი სასმელებითა და ხემსით.",
                    dinner_title: "ვახშამი",
                    dinner_description: "საქორწილო ვახშამი მხოლოდ სადღესასწაულო კერძებს კი არ შეეხება, არამედ სიხარულის, სიცილისა და სიყვარულის გაზიარებას. ჩვენ გვსურს, რომ მომავალი დაგვილოცოთ, მყუდრო კარავში, ჩვენი შეუღლების აღნიშვნისას.",
                    cake_title: "ტორტი",
                    cake_description: "შემოგვიერთდით ჩვენი ცხოვრების ახალ ეტაპზე ტორტის ტკბილი ნაჭრით. ტორტს გემო ექნება ისეთივე, როგორიც ჩვენს სიყვარულს: ტკბილი და შეუდარებელი. :)",
                    info_title: "გთხოვთ, შეავსოთ",
                    info_description: "გთხოვთ, შეავსოთ ქვემოთ მოცემული ფორმა არაუგვიანეს 23 ივლისისა. „3 წლამდე“ სვეტი ეხება 3 წლამდე ბავშვებს.",
                    info_name: "სახელი",
                    info_attending: "შემოგიერთდებით",
                    info_vegan: "ვეგანი",
                    info_age3: "3 წლამდე",
                    info_note: "შენიშვნა",
                    input_placeholder: "სახელი",
                    info_add_guest: "დაამატეთ კომპანიონი",
                    info_submit: "გამოაგზავნეთ პასუხი",
                    popup_companion: "გთხოვთ, ჩაწეროთ თქვენი კომპანიონის სრული სახელი შესაბამის ველში.",
                    popup_respond_success: "დიდი მადლობა, თქვენი პასუხი მიღებულია.",
                    tipp_google_maps: "დააწკაპუნეთ მისამართზე, თუ გსურთ მისი ნახვა Google Maps-ზეც.",
                    tipp_respond: "გმადლობთ პასუხისთვის. პასუხის შეცვლა შესაძლებელია 23 ივლისამდე, ამავე ფორმის შევსებისა და ხელახლა გამოგზავნით.",
                    tipp_gift: ""
                },
            }

            let infoTimeOut;
            isInfoOpen = false;
            $welcome = $('.welcome');
            $weddingCanvas = $('#wedding-canvas');
            $detailsButton = $('.info .details');
            $infoBar = $('.info-bar');
            $churchBtn = $('.church-btn');
            $civilBtn = $('.civil-btn');
            $dinnerBtn = $('.dinner-btn');
            $cakeBtn = $('.cake-btn');
            $infoDetailsContainer = $('.info-details-container');
            $welcomeTitle = $('.welcome-title');
            $infoTable = $(".info-table");
            $infoTableData = $(".info-table-data");
            $infoSendButton = $(".info-send-button");
            let welcomeOfset;
            let welcomeTitleOffset = $('.welcome .info').offset().top - $welcomeTitle.outerHeight(true);
            $('.info-bar').css({
                'display': 'none'
            });
            $infoDetailsContainer.css({
                'display': 'none'
            });
            
            const toggleInfo = () => {
                if (isInfoOpen) {
                    welcomeOfset = $('body').height()/2 - $welcome.height()/2;
                    console.log($('body').height(), $welcome.height(), welcomeOfset);
                    $welcome.css({
                        'top': `${welcomeOfset}px`
                    });
                    
                } else {
                    $welcome.css({
                            'top': `${0 - welcomeTitleOffset}px`
                    });
                    let infoOffset =  $welcomeTitle.outerHeight(true) + $('.info').outerHeight(true);
                    console.log('infoOffset', infoOffset);
                    $infoDetailsContainer.css({
                        'top': `${infoOffset}px`
                    });
                }
                isInfoOpen = !isInfoOpen;
            }

            const onResize = () => {
                if (!isInfoOpen) {
                    let welcomeOfset = $('body').height()/2 - $welcome.height()/2;
                    $welcome.css({
                        'top': `${welcomeOfset}px`
                    });
                }
                $weddingCanvas.width($('.canvas-container').width());
            }

            const getQueryParam = (param) => {
                let params = new URLSearchParams(window.location.search);
                return params.get(param);
            }

            onResize();

            $(window).on('resize', onResize);

            $detailsButton.on('click', (event) => {
                if (infoTimeOut) {
                    clearTimeout(infoTimeOut);
                }
                console.log('click');
                if (isInfoOpen) {
                    $infoDetailsContainer.addClass('start')
                    $infoDetailsContainer.fadeOut(500, () => {
                            $('.info-bar').slideToggle(350, () => {
                            toggleInfo();
                            $('.welcome > p').toggleClass('transparent');
                            $('.welcome .date').toggleClass('transparent');
                            $detailsButton.addClass('shake-rep')
                        });
                    })
                } else {
                    $detailsButton.removeClass('shake-rep')
                    $('.info-bar').slideToggle(350, () => {
                            toggleInfo();
                            $('.welcome > p').toggleClass('transparent');
                            $('.welcome .date').toggleClass('transparent');
                            infoTimeOut = setTimeout(() => {
                                $infoDetailsContainer.fadeIn(500);
                                $infoDetailsContainer.removeClass('start')
                                $('.google-maps').addClass('shake-rep');
                            }, 500)
                            
                    })
                }
                
            })

            $infoBar.on("click", "div", function() {
                $infoBar.css({
                    '--translate-btn': `${$(this).index() * $(this).outerWidth(true)}px`
                });
                container = document.querySelector('.info-details-container');
                container.scrollTo($(this).index() * $infoDetailsContainer.first().outerWidth(true), 250);
            });

            let guestId = getQueryParam('guest');
            if (guestId != null) {
                $.get(`https://api.nino-ricsi.wedding:3000/guests/${guestId}`)
                .done(function (data) {
                    $("body").empty();
                    $("body").append(`<div id="taskContent"></div>`);
                    if (data['taskdone']) {
                        $("#taskContent").append(`<div class="task-title">Tombola számod:</div>`);
                        $("#taskContent").append(`<div class="tombola-holder"><div class="tombola-frame">${data['tombola']}</div></div>`);
                        $("#taskContent").append(`Gratulálunk ${data['address']}! Sok sikert a tombolához.`);    
                    } else {
                        $("#taskContent").append(`<div class="task-title">A Feladat</div>`);
                        $("#taskContent").append(`<div class="task-description" id="newElement">Kedves ${data['address']}, teljesítsd az alábbi feladatot, hogy részt vehess a tombolán: </div>`)
                        $("#taskContent").append(`<div id="the-task" class="task-description">${data['task']}</div>`)
                        $("#taskContent").append(`<div class="task-description">Ha teljesítetted a feladatod, kérj meg valakit, hogy igazolja. Ehhez az illető használja a saját QR kódját és kövesse az "Igazolás" bekezdésben leírtakat. Ezután frissítheted az oldalt, vagy újra leolvashatod a QR kódodat, hogy lásd a tombola számodat.</div>`)
                    }
                    $("#taskContent").append(`<div class="task-title">Igazolás</div>`);
                    $("#taskContent").append(`<div class="task-description">Ha valaki teljesítette a saját feladatát és te tanúja voltál ennek, akkor kérünk, hogy jelezd felénk, hogy az illető részt vehessen a tombolán. Ehhez válaszd ki a nevét az alábbi lenyíló listából, majd nyomd meg a "Megerősítem" gombot. Saját feladatodat nem tudod igazolni.</div>`)
                    $("#taskContent").append(`<div class="cert-frame">
                                                <div class="task-description">Igazolom, hogy </div>
                                                <div id=guestListHolder><select id="guestList"></select></div>
                                                <div class="task-description">teljesítette a feladatát. </div>
                                                <button id="send-task" class="pink-button">Megerősítem</button>
                                                </div>`);
                    $("#taskContent").append(`
                    <div id="popup" class="popup">
                        <span id="popup-message"></span>
                    </div>
                    `)
                    
                    $.get('https://api.nino-ricsi.wedding:3000/guests', function(data) {
                        data.sort(function(a, b) {
                            return a.name.localeCompare(b.name);
                        });
                        data.forEach(function(guest) {
                            if (guest._id != guestId && guest.attending) {
                                var option = $('<option>').text(guest.name).val(guest._id);
                                $('#guestList').append(option);
                            }
                        });
                        $("#send-task").on("click", function() {
                            console.log("click");
                            var selectedGuestId = $('#guestList').val();
                            $.ajax({
                                url: `https://api.nino-ricsi.wedding:3000/guests/${selectedGuestId}`,
                                type: 'PATCH',
                                contentType: 'application/json',
                                data: JSON.stringify({taskdone: true}),
                                success: function(data) {
                                    console.log("siker");
                                    showToast(strings[lang]['popup_respond_success'], 4000);
                                },
                                error: function(error) {
                                    console.log('Error:', error);
                                    showToast(error, 4000);
                                }
                            });
                        })
                        })
                        .fail(function() {
                            alert("Error occurred while fetching the data");
                        });
                    
                })


            }

            let groupId = getQueryParam('g');
            if (groupId == null) {
                groupId = localStorage.getItem('groupId');
            } else {
                localStorage.setItem('groupId', groupId);
            }
            

            $.get(`https://api.nino-ricsi.wedding:3000/groups/${groupId}`)
            .done(function(data) {
                lang = data['lang'];
                if (lang != 'hu' && lang != 'en' && lang != 'ge') {
                    lang = 'hu';
                }

                $("[data-translate-key]").each(function() {
                    var key = $(this).data("translate-key");
                    $(this).html(strings[lang][key]);
                });
                $('#myInput').attr('placeholder', strings[lang]['input_placeholder']);
                $('#guest-names').append(`${data['address']},`);
                if (data['respond'] == true) {
                    $('.info-details-respond-p').text(strings[lang]['tipp_respond']);
                }
            })
            .fail(function(xhr, status, error) {
                $('.civil-btn').remove();
                $('.dinner-btn').remove();
                $('.cake-btn').remove();
                $('.info-btn').remove();
            });

            $.get(`https://api.nino-ricsi.wedding:3000/groups/${groupId}/guests`, function(data) {
                data.forEach(element => {
                    console.log(element._id);
                    $infoTableData.append(
                        `<div class="info-table-values" data-id="${element._id}">
                            <div class="name">${element.name}</div>
                            <div><input class="attending" type="checkbox" ${element.attending?'checked':''}></div>
                            <div><input class="vegetarian" type="checkbox" ${element.vegetarian?'checked':''}></div>
                            <div><input class="age3" type="checkbox" ${element.age3?'checked':''}></div>
                        </div>`
                    )
                });
            })

            $('.info-add-guest-button').on('click', (event) => {
                event.preventDefault();
                var inputValue = $('#myInput').val();
                if (inputValue == "" || inputValue == null) {
                    showToast(strings[lang]['popup_companion'], 4000, () => $('#myInput').addClass('shake'), () => $('#myInput').removeClass('shake'))
                } else {
                    $infoTableData.append(
                    `<div class="info-table-values" data-id="">
                                <div class="name">${inputValue}</div>
                                <div><input class="attending" type="checkbox" 'checked'}></div>
                                <div><input class="vegetarian" type="checkbox"}></div>
                                <div><input class="age3" type="checkbox"}></div>
                    </div>`
                    )
                }
            })

            function respondSent() {
                $.ajax({
                    url: `https://api.nino-ricsi.wedding:3000/groups/${groupId}`,
                    type: 'PATCH',
                    contentType: 'application/json',
                    data: JSON.stringify({respond: true}),
                    success: function(data) {
                        showToast(strings[lang]['popup_respond_success'], 4000);
                        $('.info-details-respond-p').text(strings[lang]['tipp_respond']);
                    },
                    error: function(error) {
                        console.log('Error:', error);
                    }
                });
            }

            let data = [];

            $infoSendButton.on("click", (event) => {
                data.length = 0;
                $(".info-table-values").each(function() {
                    if ($(this).data('id') != "") {
                        data.push({
                            _id: $(this).data('id'),
                            attending: $(this).find('.attending').is(':checked'),
                            vegetarian: $(this).find('.vegetarian').is(':checked'),
                            age3: $(this).find('.age3').is(':checked')
                        })
                    } else {
                        console.log("nincs data");
                        data.push({
                            name: $(this).find('.name').text(),
                            group: groupId,
                            attending: $(this).find('.attending').is(':checked'),
                            vegetarian: $(this).find('.vegetarian').is(':checked'),
                            age3: $(this).find('.age3').is(':checked')
                        })
                    }
                });
                $.ajax({
                    url: "https://api.nino-ricsi.wedding:3000/guests",
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function(data) {
                        console.log(data);
                        respondSent();
                    },
                    error: function(error) {
                        console.log('Error:', error);
                    }
                });
            })
            
            $('.dinner-btn').on('click', (event) => {
                if (lang == 'hu' || lang == 'en') {
                    setTimeout(()=>{
                        showToast(strings[lang]['tipp_gift'], 10000, null, null);
                    }, 2000)
                    
                }
            })

        })
    </script>
</body>
</html>